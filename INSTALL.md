# Installation Guide

## Prerequisites

Before installing, you need:
- Home Assistant OS or Supervised installation 
- YouTube OAuth credentials (`credentials.json` and `token.pickle`) **[REVIEW: The token.pickle gets created by the app when first configuring the addon, google doesn't provide a pickle to user]**
  → See [DOCS.md](DOCS.md) for how to obtain these files
- A Home Assistant Long-Lived Access Token **[REVIEW: This is depreciated, we are no longer using a long lived token, it is now using the SUPERVISOR_TOKEN which is automatic with a hass addon]**
- Your media player entity ID (e.g., `media_player.apple_tv`)

## Installation Steps

### 1. Add Repository to Home Assistant

1. Under Settings -> Addons -> Click triple dots in top right corner and add repository.
2. Add this repository URL:
   ```
   https://github.com/mdupreejr/youtube-thumbs
   ```
2. Find **"YouTube Thumbs Rating"** in the available add-ons

### 3. Copy OAuth Credentials

Before starting the add-on, copy your OAuth files:

1. Via **File Editor** or **Samba share**, navigate to:
   ```
   /addon_configs/XXXXXXXX_youtube_thumbs/
   ```
   (XXXXXXXX will be a random string generated by Home Assistant)

2. Copy both files to this directory: **[REVIEW: Again user doesn't have a pickle, app generates it]**
   - `credentials.json`
   - `token.pickle`

**Samba path**: `\\homeassistant.local\addon_configs\XXXXXXXX_youtube_thumbs\`

### 4. Configure the Add-on

1. In the Add-ons section, click on **YouTube Thumbs*
2. Go to the **Configuration** tab
3. Fill in the required fields:

```yaml
home_assistant_url: http://supervisor/core **[REVIEW: This doesn't need to be set, it is standard across all intalls]**
home_assistant_token: "YOUR_LONG_LIVED_ACCESS_TOKEN_HERE" **[REVIEW: We are not using long lived access tokens anymore]**
media_player_entity: media_player.apple_tv
port: 21812
host: 0.0.0.0 **[REVIEW: This isn't required as the app runs on the same host as the supervisor so it always connects to the supervisor locally]**
rate_limit_per_minute: 10 **[REVIEW: Explain what the rate limits mean exactly]**
rate_limit_per_hour: 100
rate_limit_per_day: 500
log_level: INFO
```

#### Finding your media player entity:
1. Go to **Developer Tools** → **States**
2. Search for your AppleTV (e.g., `media_player.apple_tv`)
3. Copy the **exact entity ID** and paste it in the `media_player_entity` field

### 5. Start the Add-on

### 6. Verify It's Running

1. Go to the **Log** tab
2. Check for successful startup messages:
   ```
   [INFO] Starting YouTube Thumbs service on 0.0.0.0:21812...
   [INFO] Home Assistant URL: http://supervisor/core
   [INFO] Media Player Entity: media_player.apple_tv
   ```
3. If you see OAuth credential warnings, verify you copied the files to the correct location

### 7. Configure Home Assistant

Add REST commands to your `configuration.yaml`:

1. Go to **Settings** → **Add-ons** → **File Editor** (or use your preferred editor)
2. Open `configuration.yaml`
3. Add this configuration:

```yaml
rest_command:
  youtube_thumbs_up:
    url: "http://localhost:21812/thumbs_up"
    method: POST
    timeout: 30
    
  youtube_thumbs_down:
    url: "http://localhost:21812/thumbs_down"
    method: POST
    timeout: 30
```

4. Save the file
5. Go to **Developer Tools** → **YAML** → **Check Configuration** -> **Restart**

### 8. Test the Integration

1. Start playing music on youtube on AppleTV
2. Go to **Developer Tools** → **Services**
3. Search for `rest_command.youtube_thumbs_up`
4. Click **CALL SERVICE**
5. Check the add-on logs (Settings → Add-ons → YouTube Thumbs Rating → Log tab)
6. You should see a success message with the video that was rated

### 9. Create Automations (Optional)

Example for Lutron remote buttons:

```yaml
automation:
  - alias: "Music - Thumbs Up"
    trigger:
      - platform: device
        device_id: YOUR_LUTRON_DEVICE_ID
        type: press
        subtype: button_1
    action:
      - service: rest_command.youtube_thumbs_up

  - alias: "Music - Thumbs Down"
    trigger:
      - platform: device
        device_id: YOUR_LUTRON_DEVICE_ID
        type: press
        subtype: button_2
    action:
      - service: rest_command.youtube_thumbs_down
```

## Troubleshooting

### Add-on won't start
- Check logs for specific error messages
- Verify media player entity ID is correct

### "No media currently playing" error
- Make sure music is actually playing on your AppleTV and that it shows on your appletv device on hass.

### OAuth errors
- Verify `credentials.json` is from Google Cloud Console with YouTube Data API v3 enabled
- Check `token.pickle` hasn't expired **[REVIEW: How is a user suppose to be able to do this?]**

### Can't find the add-on in the store
- Try refreshing the Add-on Store page
- Check Settings → Add-ons → Add-on Store → ⋮ → Check for updates
- Restart Home Assistant if the add-on still doesn't appear
