<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Thumbs - Logs</title>
    <link rel="stylesheet" href="{{ static_url('css/common.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <h1>YouTube Thumbs Rating</h1>
                <div class="nav-links">
                    <a href="{{ ingress_path }}/?tab=tests">Tests</a>
                    <a href="{{ ingress_path }}/?tab=rating">Bulk Rating</a>
                    <a href="{{ ingress_path }}/stats">Stats</a>
                    <a href="{{ ingress_path }}/data">Database</a>
                    <a href="{{ ingress_path }}/logs" class="active">Logs</a>
                    <a href="{{ ingress_path }}/database">DB Admin</a>
                </div>
            </div>
        </header>

        <div class="card">
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <a href="{{ ingress_path }}/logs?tab=rated" class="tab-button {{ 'active' if current_tab == 'rated' else '' }}">
                    Rated Songs
                </a>
                <a href="{{ ingress_path }}/logs?tab=matches" class="tab-button {{ 'active' if current_tab == 'matches' else '' }}">
                    Matches
                </a>
                <a href="{{ ingress_path }}/logs?tab=recent" class="tab-button {{ 'active' if current_tab == 'recent' else '' }}">
                    Recent
                </a>
                <a href="{{ ingress_path }}/logs?tab=errors" class="tab-button {{ 'active' if current_tab == 'errors' else '' }}">
                    Errors
                </a>
                <a href="{{ ingress_path }}/logs/api-calls" class="tab-button">
                    API Calls
                </a>
                <a href="{{ ingress_path }}/logs/pending-ratings" class="tab-button">
                    Queue
                </a>
            </div>

            <!-- Rated Songs Tab -->
            {% if current_tab == 'rated' %}
            <form method="GET" action="{{ ingress_path }}/logs">
                <input type="hidden" name="tab" value="rated">
                <div class="filters">
                    <div class="filter-group">
                        <label for="period">Time Period:</label>
                        <select name="period" id="period">
                            <option value="hour" {{ 'selected' if period_filter == 'hour' else '' }}>Last Hour</option>
                            <option value="day" {{ 'selected' if period_filter == 'day' else '' }}>Last Day</option>
                            <option value="week" {{ 'selected' if period_filter == 'week' else '' }}>Last Week</option>
                            <option value="month" {{ 'selected' if period_filter == 'month' else '' }}>Last Month</option>
                            <option value="all" {{ 'selected' if period_filter == 'all' else '' }}>All Time</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="rating">Rating Type:</label>
                        <select name="rating" id="rating">
                            <option value="all" {{ 'selected' if rating_filter == 'all' else '' }}>All</option>
                            <option value="like" {{ 'selected' if rating_filter == 'like' else '' }}>Likes</option>
                            <option value="dislike" {{ 'selected' if rating_filter == 'dislike' else '' }}>Dislikes</option>
                        </select>
                    </div>
                    <button type="submit" class="apply-btn">Apply</button>
                </div>
            </form>

            <p class="info-text">
                {{ total_count }} rated songs ‚Ä¢ Page {{ page }}/{{ total_pages }}
            </p>

            {% if songs %}
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Song</th>
                            <th>Artist</th>
                            <th>Rating</th>
                            <th>Plays</th>
                            <th>Video ID</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for song in songs %}
                        <tr>
                            <td><span class="time-ago">{{ song.time_ago }}</span></td>
                            <td>{{ song.title }}</td>
                            <td>{{ song.artist }}</td>
                            <td>
                                {% if song.rating == 'like' %}
                                    <span class="badge badge-like">üëç Like</span>
                                {% elif song.rating == 'dislike' %}
                                    <span class="badge badge-dislike">üëé Dislike</span>
                                {% endif %}
                            </td>
                            <td><span class="badge badge-count">{{ song.play_count }}</span></td>
                            <td>
                                <a href="https://youtube.com/watch?v={{ song.yt_video_id }}" target="_blank">{{ song.yt_video_id }}</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">üì≠</div>
                <h3>No rated songs found</h3>
                <p>Try adjusting your filters</p>
            </div>
            {% endif %}
            {% endif %}

            <!-- Matches Tab -->
            {% if current_tab == 'matches' %}
            <form method="GET" action="{{ ingress_path }}/logs">
                <input type="hidden" name="tab" value="matches">
                <div class="filters">
                    <div class="filter-group">
                        <label for="period">Time Period:</label>
                        <select name="period" id="period">
                            <option value="hour" {{ 'selected' if period_filter == 'hour' else '' }}>Last Hour</option>
                            <option value="day" {{ 'selected' if period_filter == 'day' else '' }}>Last Day</option>
                            <option value="week" {{ 'selected' if period_filter == 'week' else '' }}>Last Week</option>
                            <option value="month" {{ 'selected' if period_filter == 'month' else '' }}>Last Month</option>
                            <option value="all" {{ 'selected' if period_filter == 'all' else '' }}>All Time</option>
                        </select>
                    </div>
                    <button type="submit" class="apply-btn">Apply</button>
                </div>
            </form>

            <p class="info-text">
                {{ total_count }} matches ‚Ä¢ Page {{ page }}/{{ total_pages }}
            </p>

            {% if matches %}
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 30px;"></th>
                            <th>Time</th>
                            <th>HA Song</th>
                            <th>Matched To (YouTube)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for match in matches %}
                        <tr>
                            <td>
                                <button class="expand-btn" onclick="toggleMatch('{{ match.yt_video_id }}')">‚ñ∂</button>
                            </td>
                            <td><span class="time-ago">{{ match.time_ago }}</span></td>
                            <td>{{ match.ha_title }} <em style="color: #64748b;">by {{ match.ha_artist }}</em></td>
                            <td>
                                <a href="https://www.youtube.com/watch?v={{ match.yt_video_id }}" target="_blank" rel="noopener noreferrer" style="color: #2563eb; text-decoration: none; font-weight: 500;">
                                    {{ match.yt_title }}
                                </a>
                                <em style="color: #64748b;"> by {{ match.yt_channel }}</em>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="4" style="padding: 0;">
                                <div class="match-details" id="match-{{ match.yt_video_id }}">
                                    <div class="detail-grid">
                                        <div class="detail-section">
                                            <h4>üè† Home Assistant Info</h4>
                                            <div class="detail-row">
                                                <span class="detail-label">Title:</span>
                                                <span class="detail-value">{{ match.ha_title }}</span>
                                            </div>
                                            <div class="detail-row">
                                                <span class="detail-label">Artist:</span>
                                                <span class="detail-value">{{ match.ha_artist }}</span>
                                            </div>
                                            <div class="detail-row">
                                                <span class="detail-label">Duration:</span>
                                                <span class="detail-value">{{ match.ha_duration }}s</span>
                                            </div>
                                        </div>

                                        <div class="detail-section">
                                            <h4>‚ñ∂Ô∏è YouTube Match</h4>
                                            <div class="detail-row">
                                                <span class="detail-label">Title:</span>
                                                <span class="detail-value">{{ match.yt_title }}</span>
                                            </div>
                                            <div class="detail-row">
                                                <span class="detail-label">Channel:</span>
                                                <span class="detail-value">{{ match.yt_channel }}</span>
                                            </div>
                                            <div class="detail-row">
                                                <span class="detail-label">Duration:</span>
                                                <span class="detail-value">{{ match.yt_duration }}s</span>
                                            </div>
                                            <div class="detail-row">
                                                <span class="detail-label">Video ID:</span>
                                                <span class="detail-value">
                                                    <a href="https://youtube.com/watch?v={{ match.yt_video_id }}" target="_blank">{{ match.yt_video_id }}</a>
                                                </span>
                                            </div>
                                            {% if match.yt_published_at %}
                                            <div class="detail-row">
                                                <span class="detail-label">Uploaded:</span>
                                                <span class="detail-value">{{ match.yt_published_at }}</span>
                                            </div>
                                            {% endif %}
                                        </div>

                                        <div class="detail-section">
                                            <h4>‚ú® Match Quality</h4>
                                            <div class="detail-row">
                                                <span class="detail-label">Duration Diff:</span>
                                                <span class="detail-value {{ 'quality-good' if match.match_quality == 'good' else 'quality-fair' }}">
                                                    {% if match.duration_diff > 0 %}+{% endif %}{{ match.duration_diff }}s
                                                    {% if match.match_quality == 'good' %}‚úì{% endif %}
                                                </span>
                                            </div>
                                            <div class="detail-row">
                                                <span class="detail-label">Attempts:</span>
                                                <span class="detail-value">{{ match.match_attempts }}</span>
                                            </div>
                                            <div class="detail-row">
                                                <span class="detail-label">Popularity:</span>
                                                <span class="detail-value">{{ match.play_count }} plays</span>
                                            </div>
                                            <div class="detail-row">
                                                <span class="detail-label">Matched:</span>
                                                <span class="detail-value">{{ match.timestamp }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">üîç</div>
                <h3>No matches found</h3>
                <p>Try adjusting your filters</p>
            </div>
            {% endif %}
            {% endif %}

            <!-- Errors Tab -->
            {% if current_tab == 'errors' %}
            <form method="GET" action="{{ ingress_path }}/logs">
                <input type="hidden" name="tab" value="errors">
                <div class="filters">
                    <div class="filter-group">
                        <label for="period">Time Period:</label>
                        <select name="period" id="period">
                            <option value="hour" {{ 'selected' if period_filter == 'hour' else '' }}>Last Hour</option>
                            <option value="day" {{ 'selected' if period_filter == 'day' else '' }}>Last Day</option>
                            <option value="week" {{ 'selected' if period_filter == 'week' else '' }}>Last Week</option>
                            <option value="month" {{ 'selected' if period_filter == 'month' else '' }}>Last Month</option>
                            <option value="all" {{ 'selected' if period_filter == 'all' else '' }}>All Time</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="level">Level:</label>
                        <select name="level" id="level">
                            <option value="all" {{ 'selected' if level_filter == 'all' else '' }}>All</option>
                            <option value="ERROR" {{ 'selected' if level_filter == 'ERROR' else '' }}>ERROR</option>
                            <option value="WARNING" {{ 'selected' if level_filter == 'WARNING' else '' }}>WARNING</option>
                            <option value="INFO" {{ 'selected' if level_filter == 'INFO' else '' }}>INFO</option>
                        </select>
                    </div>
                    <button type="submit" class="apply-btn">Apply</button>
                </div>
            </form>

            {% if log_error %}
            <div style="padding: 10px; background: #fee2e2; color: #991b1b; border-radius: 4px; margin-bottom: 10px;">
                {{ log_error }}
            </div>
            {% endif %}

            <p class="info-text">
                {{ total_count }} errors ‚Ä¢ Page {{ page }}/{{ total_pages }}
            </p>

            {% if errors %}
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Level</th>
                            <th>Message</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for error in errors %}
                        <tr>
                            <td><span class="timestamp" title="{{ error.time_ago }}">{{ error.timestamp }}</span></td>
                            <td>
                                <span class="badge badge-{{ error.level|lower }}">{{ error.level }}</span>
                            </td>
                            <td>
                                <div class="error-message">
                                    <div class="error-short">{{ error.display_message }}</div>
                                    {% if error.truncated %}
                                    <div class="error-full" id="error-{{ loop.index }}">{{ error.message }}</div>
                                    <span class="show-more" onclick="toggleError({{ loop.index }})">Show more</span>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">‚úì</div>
                <h3>No errors found</h3>
                <p>System is running smoothly!</p>
            </div>
            {% endif %}
            {% endif %}

            <!-- Pagination -->
            {% if total_pages > 0 %}
            <div class="pagination">
                {% if page > 1 %}
                    <a href="{{ ingress_path }}/logs?tab={{ current_tab }}&page={{ page - 1 }}&period={{ period_filter }}{% if current_tab == 'rated' %}&rating={{ rating_filter }}{% endif %}{% if current_tab == 'errors' %}&level={{ level_filter }}{% endif %}">‚Üê Prev</a>
                {% else %}
                    <button disabled>‚Üê Prev</button>
                {% endif %}

                {% for page_num in page_numbers %}
                    {% if page_num == '...' %}
                        <span class="ellipsis">...</span>
                    {% elif page_num == page %}
                        <span class="current-page">{{ page_num }}</span>
                    {% else %}
                        <a href="{{ ingress_path }}/logs?tab={{ current_tab }}&page={{ page_num }}&period={{ period_filter }}{% if current_tab == 'rated' %}&rating={{ rating_filter }}{% endif %}{% if current_tab == 'errors' %}&level={{ level_filter }}{% endif %}">{{ page_num }}</a>
                    {% endif %}
                {% endfor %}

                {% if page < total_pages %}
                    <a href="{{ ingress_path }}/logs?tab={{ current_tab }}&page={{ page + 1 }}&period={{ period_filter }}{% if current_tab == 'rated' %}&rating={{ rating_filter }}{% endif %}{% if current_tab == 'errors' %}&level={{ level_filter }}{% endif %}">Next ‚Üí</a>
                {% else %}
                    <button disabled>Next ‚Üí</button>
                {% endif %}
            </div>
            {% endif %}


            <!-- Recent Videos Tab -->
            {% if current_tab == 'recent' %}
            <div class="stats-grid" style="margin-bottom: 1em;">
                <div class="stat-card">
                    <div style="font-size: 0.75em; color: #64748b; margin-bottom: 0.3em;">Recently Added</div>
                    <div style="font-size: 1.3em; font-weight: 700; color: #2563eb;">{{ total_count }}</div>
                </div>
            </div>

            {% if recent_videos %}
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width: 25%;">Title</th>
                            <th style="width: 15%;">Artist</th>
                            <th style="width: 20%;">Channel</th>
                            <th style="width: 15%;">Date Added</th>
                            <th style="width: 10%;">Rating</th>
                            <th style="width: 10%;">Plays</th>
                            <th style="width: 5%;">Link</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for video in recent_videos %}
                        <tr>
                            <td>
                                <span style="font-weight: 500;">{{ video.ha_title or video.yt_title or 'Unknown' }}</span>
                                {# v4.0.0: Removed pending status display - pending videos no longer in video_ratings #}
                            </td>
                            <td>{{ video.ha_artist or '-' }}</td>
                            <td>{{ video.yt_channel or '-' }}</td>
                            <td style="white-space: nowrap; font-size: 0.85em;">
                                {% if video.date_added %}
                                    {{ (video.date_added|string)[:10] }} {{ (video.date_added|string)[11:19] }}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>
                                {% if video.rating == 'like' %}
                                    <span style="color: #10b981;">üëç Like</span>
                                {% elif video.rating == 'dislike' %}
                                    <span style="color: #ef4444;">üëé Dislike</span>
                                {% else %}
                                    <span style="color: #94a3b8;">- None</span>
                                {% endif %}
                            </td>
                            <td style="text-align: center;">{{ video.play_count or 0 }}</td>
                            <td style="text-align: center;">
                                {% if video.yt_url %}
                                <a href="{{ video.yt_url }}" target="_blank" style="color: #2563eb; text-decoration: none; font-size: 1.2em;" title="Watch on YouTube">üîó</a>
                                {% else %}
                                -
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-icon">üì≠</div>
                <h3>No Videos Yet</h3>
                <p>No videos have been added to the database yet.</p>
            </div>
            {% endif %}

            <!-- Queue Tab -->
            {% if current_tab == 'queue' %}
            <h2>Queue Statistics & Activity</h2>

            <!-- Queue Health Status -->
            <div class="stats-section">
                <h3>Worker Health</h3>
                <div class="stats-grid">
                    <div class="stat-card {{ 'success' if queue_stats.worker_health.is_active else 'warning' }}">
                        <div class="stat-label">Worker Status</div>
                        <div class="stat-value">{{ 'üü¢ Active' if queue_stats.worker_health.is_active else 'üî¥ Inactive' }}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Last Rating Activity</div>
                        <div class="stat-value">{{ queue_stats.worker_health.last_rating_activity_relative if queue_stats.worker_health.last_rating_activity_relative else 'Never' }}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Last Search Activity</div>
                        <div class="stat-value">{{ queue_stats.worker_health.last_search_activity_relative if queue_stats.worker_health.last_search_activity_relative else 'Never' }}</div>
                    </div>
                </div>
            </div>

            <!-- Queue Statistics -->
            <div class="stats-section">
                <h3>Queue</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Rating Queue</div>
                        <div class="stat-value">{{ queue_stats.rating_queue.pending }}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Processed (24h)</div>
                        <div class="stat-value">{{ queue_stats.rating_queue.processed_24h }}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Success Rate (24h)</div>
                        <div class="stat-value">{{ queue_stats.rating_queue.success_rate_24h }}%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Avg Attempts</div>
                        <div class="stat-value">{{ queue_stats.rating_queue.avg_attempts }}</div>
                    </div>
                </div>
            </div>

            <!-- Search Queue Statistics -->
            <div class="stats-section">
                <h3>Search Queue</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Pending</div>
                        <div class="stat-value">{{ queue_stats.search_queue.pending }}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Completed</div>
                        <div class="stat-value">{{ queue_stats.search_queue.completed }}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Failed</div>
                        <div class="stat-value">{{ queue_stats.search_queue.failed }}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Success Rate (24h)</div>
                        <div class="stat-value">{{ queue_stats.search_queue.success_rate_24h }}%</div>
                    </div>
                </div>
            </div>

            <!-- Recent Rating Activity -->
            <div class="stats-section">
                <h3>Recent Rating Activity (Last 30)</h3>
                {% if queue_activity.recent_ratings %}
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Requested</th>
                                <th>Song</th>
                                <th>Rating</th>
                                <th>Status</th>
                                <th>Attempts</th>
                                <th>Last Attempt</th>
                                <th>Error</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for rating in queue_activity.recent_ratings %}
                            <tr class="{{ 'success' if rating.status == 'success' else ('error' if rating.status == 'failed' else 'pending') }}">
                                <td><span class="time-ago">{{ rating.requested_at_relative }}</span></td>
                                <td>{{ rating.ha_title }}</td>
                                <td>{{ 'üëç' if rating.requested_rating == 'like' else 'üëé' }}</td>
                                <td>{{ rating.status }}</td>
                                <td>{{ rating.attempts }}</td>
                                <td><span class="time-ago">{{ rating.last_attempt_relative if rating.last_attempt else 'Never' }}</span></td>
                                <td>{{ rating.error if rating.error else '-' }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="info-text">No rating queue activity</p>
                {% endif %}
            </div>

            <!-- Recent Search Activity -->
            <div class="stats-section">
                <h3>Recent Search Activity (Last 30)</h3>
                {% if queue_activity.recent_searches %}
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Requested</th>
                                <th>Song</th>
                                <th>Artist</th>
                                <th>Status</th>
                                <th>Attempts</th>
                                <th>Last Attempt</th>
                                <th>Callback</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for search in queue_activity.recent_searches %}
                            <tr class="{{ 'success' if search.status == 'completed' else ('error' if search.status == 'failed' else 'pending') }}">
                                <td><span class="time-ago">{{ search.requested_at_relative }}</span></td>
                                <td>{{ search.ha_title }}</td>
                                <td>{{ search.ha_artist }}</td>
                                <td>{{ search.status }}</td>
                                <td>{{ search.attempts }}</td>
                                <td><span class="time-ago">{{ search.last_attempt_relative if search.last_attempt else 'Never' }}</span></td>
                                <td>{{ search.callback_rating if search.callback_rating else '-' }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="info-text">No search queue activity</p>
                {% endif %}
            </div>

            <!-- Recent Errors -->
            <div class="stats-section">
                <h3>Recent Queue Errors</h3>
                {% if queue_errors.rating_errors or queue_errors.search_errors %}
                    {% if queue_errors.rating_errors %}
                    <h4>Rating Errors</h4>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Song</th>
                                    <th>Rating</th>
                                    <th>Attempts</th>
                                    <th>Last Attempt</th>
                                    <th>Error</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for error in queue_errors.rating_errors %}
                                <tr class="error">
                                    <td>{{ error.ha_title }}</td>
                                    <td>{{ 'üëç' if error.requested_rating == 'like' else 'üëé' }}</td>
                                    <td>{{ error.attempts }}</td>
                                    <td><span class="time-ago">{{ error.last_attempt_relative }}</span></td>
                                    <td>{{ error.error }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% endif %}

                    {% if queue_errors.search_errors %}
                    <h4>Search Errors</h4>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Song</th>
                                    <th>Artist</th>
                                    <th>Attempts</th>
                                    <th>Last Attempt</th>
                                    <th>Error</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for error in queue_errors.search_errors %}
                                <tr class="error">
                                    <td>{{ error.ha_title }}</td>
                                    <td>{{ error.ha_artist }}</td>
                                    <td>{{ error.attempts }}</td>
                                    <td><span class="time-ago">{{ error.last_attempt_relative }}</span></td>
                                    <td>{{ error.error_message }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% endif %}
                {% else %}
                <p class="info-text">No recent queue errors</p>
                {% endif %}
            </div>
            {% endif %}
            {% endif %}
        </div>
    </div>

    <script>
        // Toggle match details accordion
        function toggleMatch(videoId) {
            const detailsDiv = document.getElementById('match-' + videoId);
            const button = event.target;

            if (detailsDiv.classList.contains('expanded')) {
                detailsDiv.classList.remove('expanded');
                button.classList.remove('expanded');
            } else {
                detailsDiv.classList.add('expanded');
                button.classList.add('expanded');
            }
        }

        // Toggle error message full text
        function toggleError(index) {
            const fullDiv = document.getElementById('error-' + index);
            const button = event.target;

            if (fullDiv.classList.contains('expanded')) {
                fullDiv.classList.remove('expanded');
                button.textContent = 'Show more';
            } else {
                fullDiv.classList.add('expanded');
                button.textContent = 'Show less';
            }
        }

        // Toggle quota prober log message full text
        function toggleQuotaLog(index) {
            const fullDiv = document.getElementById('quota-log-' + index);
            const button = event.target;

            if (fullDiv.classList.contains('expanded')) {
                fullDiv.classList.remove('expanded');
                button.textContent = 'Show more';
            } else {
                fullDiv.classList.add('expanded');
                button.textContent = 'Show less';
            }
        }
    </script>
</body>
</html>
