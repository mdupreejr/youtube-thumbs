<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Thumbs - Statistics</title>
    <meta http-equiv="refresh" content="300"> <!-- Auto-refresh every 5 minutes -->
    <link rel="stylesheet" href="{{ static_url('css/common.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <h1>YouTube Thumbs Rating</h1>
                <div class="nav-links">
                    <a href="{{ ingress_path }}/?tab=tests">Tests</a>
                    <a href="{{ ingress_path }}/?tab=rating">Bulk Rating</a>
                    <a href="{{ ingress_path }}/stats" class="active">Stats</a>
                    <a href="{{ ingress_path }}/data">Database</a>
                    
                    <!-- Logs dropdown menu -->
                    <div class="nav-dropdown">
                        <div class="nav-dropdown-btn">
                            Logs <span class="dropdown-arrow">‚ñº</span>
                        </div>
                        <div class="nav-dropdown-content">
                            <a href="{{ ingress_path }}/logs?tab=rated">Rated Songs</a>
                            <a href="{{ ingress_path }}/logs?tab=matches">Matches</a>
                            <a href="{{ ingress_path }}/logs?tab=recent">Recent</a>
                            <a href="{{ ingress_path }}/logs?tab=errors">Errors</a>
                            <a href="{{ ingress_path }}/logs/api-calls">API Calls</a>
                            <a href="{{ ingress_path }}/logs/pending-ratings">Queue</a>
                        </div>
                    </div>
                    
                    <a href="{{ ingress_path }}/database">DB Admin</a>
                </div>
            </div>
            <div style="font-size: 0.65em; color: #64748b;">Auto-refresh: 5min</div>
        </header>

        <!-- Summary Metrics -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value">{{ summary.total_videos }}</div>
                <div class="metric-label">Total Videos</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">{{ summary.total_plays }}</div>
                <div class="metric-label">Total Plays</div>
            </div>
            <div class="metric-card clickable">
                <a href="{{ ingress_path }}/stats/liked">
                    <div class="metric-value">{{ summary.liked }}</div>
                    <div class="metric-label">Liked üëç</div>
                </a>
            </div>
            <div class="metric-card clickable">
                <a href="{{ ingress_path }}/stats/disliked">
                    <div class="metric-value">{{ summary.disliked }}</div>
                    <div class="metric-label">Disliked üëé</div>
                </a>
            </div>
        </div>

        <!-- Rating Distribution -->
        <div class="card">
            <h2>Rating Distribution</h2>
            <div>
                <strong>üëç Liked ({{ summary.liked }} songs)</strong>
                <div class="bar-container">
                    <div class="bar" style="width: {{ rating_percentages.liked }}%">
                        {{ rating_percentages.liked|round(1) }}%
                    </div>
                </div>
            </div>
            <div>
                <strong>üëé Disliked ({{ summary.disliked }} songs)</strong>
                <div class="bar-container">
                    <div class="bar" style="width: {{ rating_percentages.disliked }}%">
                        {{ rating_percentages.disliked|round(1) }}%
                    </div>
                </div>
            </div>
            <div>
                <strong>‚ûñ No Rating ({{ summary.unrated }} songs)</strong>
                <div class="bar-container">
                    <div class="bar" style="width: {{ rating_percentages.unrated }}%">
                        {{ rating_percentages.unrated|round(1) }}%
                    </div>
                </div>
            </div>
        </div>

        <!-- Most Played Videos -->
        <div class="card">
            <h2>Most Played Videos</h2>
            {% if most_played %}
                {% for video in most_played %}
                <div class="list-item">
                    <div class="item-info">
                        <div class="item-title">
                            {% if video.yt_video_id %}
                                <a href="https://www.youtube.com/watch?v={{ video.yt_video_id }}" target="_blank" rel="noopener noreferrer">{{ video.title }}</a>
                            {% else %}
                                {{ video.title }}
                            {% endif %}
                            <span class="item-meta">‚Ä¢ {{ video.artist }}</span>
                        </div>
                    </div>
                    <div class="item-stat">{{ video.play_count }} plays</div>
                </div>
                {% endfor %}
            {% else %}
                <p style="color: #666; text-align: center; padding: 20px;">No data available</p>
            {% endif %}
        </div>

        <!-- Top Channels -->
        <div class="card">
            <h2>Top Channels</h2>
            {% if top_channels %}
                {% for channel in top_channels %}
                <div class="list-item">
                    <div class="item-info">
                        <div class="item-title">
                            {{ channel.yt_channel or 'Unknown' }}
                            <span class="item-meta">‚Ä¢ {{ channel.video_count }} videos ‚Ä¢ {{ channel.total_plays }} plays</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p style="color: #666; text-align: center; padding: 20px;">No data available</p>
            {% endif %}
        </div>

        <!-- Recent Activity -->
        <div class="card">
            <h2>Recent Activity</h2>
            {% if recent_activity %}
                {% for item in recent_activity %}
                <div class="list-item">
                    <div class="item-info">
                        <div class="item-title">
                            {% if item.yt_video_id %}
                                <a href="https://www.youtube.com/watch?v={{ item.yt_video_id }}" target="_blank" rel="noopener noreferrer">{{ item.title }}</a>
                            {% else %}
                                {{ item.title }}
                            {% endif %}
                            <span class="item-meta">‚Ä¢ {{ item.artist }} ‚Ä¢ {{ item.time_ago }}</span>
                        </div>
                    </div>
                    <div class="item-stat">{{ item.rating_icon }}</div>
                </div>
                {% endfor %}
            {% else %}
                <p style="color: #666; text-align: center; padding: 20px;">No recent activity</p>
            {% endif %}
        </div>
    </div>

    <script>
        // v4.0.55: Removed retry/cleanup functionality - queue handles all operations automatically
    </script>
</body>
</html>
